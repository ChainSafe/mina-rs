<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Serde Bin-prot"><meta name="keywords" content="rust, rustlang, rust-lang, bin_prot"><title>bin_prot - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script defer src="../crates.js"></script><script defer src="../main.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../bin_prot/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../bin_prot/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Crate bin_prot</a></h2><div class="sidebar-elems"><div class="block"><ul><li class="version">Version 0.1.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul></div><section><div class="block"><ul><li><a href="#reexports">Re-exports</a></li><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#traits">Traits</a></li><li><a href="#functions">Functions</a></li><li><a href="#types">Type Definitions</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../bin_prot/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1">
                                <a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div>
                        </div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">bin_prot</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/bin_prot/lib.rs.html#4-29">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="serde-bin-prot"><a href="#serde-bin-prot">Serde Bin-prot</a></h2>
<p><img src="https://github.com/ChainSafe/serde-bin-prot/actions/workflows/build-and-test.yml/badge.svg" alt="example workflow" /> <a href="https://opensource.org/licenses/Apache-2.0"><img src="https://img.shields.io/badge/License-Apache%202.0-blue.svg" alt="License" /></a>
A Rust crate that adds serde support for the <a href="https://github.com/janestreet/bin_prot">Bin_prot</a> serialization format</p>
<p>IMPORTANT: This is a work in progress. There is not currently support for all types or full test coverage.</p>
<h3 id="usage"><a href="#usage">Usage</a></h3>
<p>Following Serde convention this crate exposes a <code>from_reader</code> and <code>to_writer</code> function to serialize/deserialize bin_prot encoded streams of bytes.</p>
<h4 id="strongly-typed"><a href="#strongly-typed">Strongly Typed</a></h4>
<p>This works with any Serde supported data type or any custom type annotated with <code>#[derive(Serialize, Deserialize)]</code>.</p>
<p>Example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">bin_prot</span>::{<span class="ident">from_reader</span>, <span class="ident">to_writer</span>};

<span class="kw">fn</span> <span class="ident">main</span>() {
  <span class="kw">let</span> <span class="ident">val</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">i64</span><span class="op">&gt;</span> <span class="op">=</span> <span class="macro">vec!</span>[<span class="number">20</span>, <span class="op">-</span><span class="number">22</span>, <span class="number">38</span>];

  <span class="comment">// Example write into a vec of bytes</span>
  <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">output</span> <span class="op">=</span> <span class="ident">Vec</span>::<span class="op">&lt;</span><span class="ident">u8</span><span class="op">&gt;</span><span class="ident">::new</span>();
  <span class="ident">to_writer</span>(<span class="kw-2">&amp;mut</span> <span class="ident">output</span>, <span class="kw-2">&amp;</span><span class="ident">val</span>).<span class="ident">unwrap</span>();

  <span class="comment">// Read back into a typed value</span>
  <span class="kw">let</span> <span class="ident">de_val</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">i64</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">from_reader</span>(<span class="ident">output</span>.<span class="ident">as_slice</span>()).<span class="ident">unwrap</span>();

  <span class="macro">assert!</span>(<span class="ident">val</span> <span class="op">==</span> <span class="ident">de_val</span>)
}
</code></pre></div>
<h4 id="loosely-typed"><a href="#loosely-typed">Loosely Typed</a></h4>
<p>Despite bin_prot being a non-self-describing format it is possible to deserialize into a loosely typed value if a layout descriptor file is provided. The layout files are typically written in JSON and describe the nested data structure that
is to be deserialized. For the specification of the BinProtRule type see src/value/layout/mod.rs.</p>
<p>Note that, Loosely-typed deserialization is behind feature <code>loose_deserialization</code> which is disabled by default. Use below config snippet to turn it on.</p>
<div class="example-wrap"><pre class="language-toml"><code>bin-prot = {version=&quot;$version&quot;, features = [&quot;loose_deserialization&quot;]}</code></pre></div>
<p>These are created using the <code>Deserializer::from_reader_with_layout</code> constructor.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">serde::Deserialize</span>;
<span class="kw">use</span> <span class="ident">bin_prot</span>::{<span class="ident">Deserializer</span>, <span class="ident">BinProtRule</span>, <span class="ident">Value</span>};

<span class="comment">// this rule describes a record with two fields, one itself being a record with a bool field</span>
<span class="kw">const</span> <span class="ident">RECORD_RULE</span>: <span class="kw-2">&amp;</span><span class="ident">str</span> <span class="op">=</span> <span class="string">r#&quot;
[
  &quot;Record&quot;,
  [
    { &quot;field_name&quot;: &quot;first&quot;, &quot;field_rule&quot;: [&quot;Int&quot;] },
    { &quot;field_name&quot;: &quot;second&quot;, &quot;field_rule&quot;: [&quot;Record&quot;, [{ &quot;field_name&quot;: &quot;inner&quot;, &quot;field_rule&quot;: [&quot;Bool&quot;] }] ] }
  ]
]
&quot;#</span>;

<span class="kw">fn</span> <span class="ident">main</span>() {
    <span class="kw">let</span> <span class="ident">rule</span>: <span class="ident">BinProtRule</span> <span class="op">=</span> <span class="ident">serde_json::from_str</span>(<span class="ident">RECORD_RULE</span>).<span class="ident">unwrap</span>();

    <span class="comment">// this is the compact encoding of { first: 0, second: { inner: true } }</span>
    <span class="kw">let</span> <span class="ident">bytes</span> <span class="op">=</span> <span class="macro">vec!</span>[<span class="number">0x00</span>, <span class="number">0x01</span>];

    <span class="comment">// provide both the raw bytes and the rule descriptor to `from_reader_with_layout`</span>
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">de</span> <span class="op">=</span> <span class="ident">Deserializer::from_reader</span>(<span class="ident">bytes</span>.<span class="ident">as_slice</span>()).<span class="ident">with_layout</span>(<span class="kw-2">&amp;</span><span class="ident">rule</span>);

    <span class="comment">// we can now deserialize into a bin_prot::Value type!</span>
    <span class="kw">let</span> <span class="ident">result</span>: <span class="ident">Value</span> <span class="op">=</span> <span class="ident">Deserialize::deserialize</span>(<span class="kw-2">&amp;mut</span> <span class="ident">de</span>).<span class="ident">unwrap</span>();

    <span class="comment">// These support indexing (strings for struct fields and usize for tuple/vector types)</span>
    <span class="macro">assert_eq!</span>(
        <span class="ident">result</span>[<span class="string">&quot;second&quot;</span>][<span class="string">&quot;inner&quot;</span>],
        <span class="ident">Value::Bool</span>(<span class="bool-val">true</span>)
    )
}
</code></pre></div>
<h3 id="testing"><a href="#testing">Testing</a></h3>
<p>All tests can be run through cargo</p>
<div class="example-wrap"><pre class="language-shell"><code>cargo test</code></pre></div><h3 id="licence"><a href="#licence">Licence</a></h3>
<p>Distributed under the Apache-2.0 License. See LICENSE for more information.</p>
<h3 id="contact"><a href="#contact">Contact</a></h3>
<p><a href="mailto:willem@chainsafe.io">Willem Olding</a></p>
</div></details><h2 id="reexports" class="small-section-header"><a href="#reexports">Re-exports</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left import-item" id="reexport.BinProtRule"><code>pub use value::layout::<a class="enum" href="value/layout/enum.BinProtRule.html" title="enum bin_prot::value::layout::BinProtRule">BinProtRule</a>;</code></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left import-item" id="reexport.Layout"><code>pub use value::layout::<a class="struct" href="value/layout/struct.Layout.html" title="struct bin_prot::value::layout::Layout">Layout</a>;</code></div><div class="item-right docblock-short"></div></div><div class="item-row"><div class="item-left import-item" id="reexport.Value"><code>pub use value::<a class="enum" href="value/enum.Value.html" title="enum bin_prot::value::Value">Value</a>;</code></div><div class="item-right docblock-short"></div></div></div><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="error/index.html" title="bin_prot::error mod">error</a></div><div class="item-right docblock-short"><p>Error objects and codes</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="integers/index.html" title="bin_prot::integers mod">integers</a></div><div class="item-right docblock-short"><p>The variable length integer types used in BinProt
By default rust integer types are serialized using variable length integer. To force a specific type
annotate a field with <code>#[serde(with = &quot;nat0&quot;)] or </code>#[serde(with = “integer”)]` where nat0 and integer are
the submodule exported from this module.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="mod" href="value/index.html" title="bin_prot::value mod">value</a></div><div class="item-right docblock-short"><p>The Value enum, a loosely typed way of representing any valid bin_prot value.</p>
</div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Deserializer.html" title="bin_prot::Deserializer struct">Deserializer</a></div><div class="item-right docblock-short"><p>A BinProt deserializer that reads from a BufReader
Can operate in strong or loose deserialization mode</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Serializer.html" title="bin_prot::Serializer struct">Serializer</a></div><div class="item-right docblock-short"><p>Serializer for writing BinProt bytes to a writer</p>
</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.ReadBinProtExt.html" title="bin_prot::ReadBinProtExt trait">ReadBinProtExt</a></div><div class="item-right docblock-short"><p>Extension trait for readers implementing io::Read to allow them to read a bin_prot encoded values</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.WriteBinProtExt.html" title="bin_prot::WriteBinProtExt trait">WriteBinProtExt</a></div><div class="item-right docblock-short"><p>extension trait for writers implementing io::Write to allow them to write
the primitive values for bin_prot</p>
</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.caml_hash_variant.html" title="bin_prot::caml_hash_variant fn">caml_hash_variant</a></div><div class="item-right docblock-short"><p>Hash the label string (ASCII not UTF-8) into a OCaml style variant hash</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.from_reader.html" title="bin_prot::from_reader fn">from_reader</a></div><div class="item-right docblock-short"><p>Convenience method, create a BinProt deserializer from the given reader and then
read from it</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.to_writer.html" title="bin_prot::to_writer fn">to_writer</a></div><div class="item-right docblock-short"><p>Convenience function, creates  serializer and uses it to write the given value
to the writer</p>
</div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.VariantHash.html" title="bin_prot::VariantHash type">VariantHash</a></div><div class="item-right docblock-short"><p>Type alias for hash result</p>
</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="bin_prot" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.64.0-nightly (495b21669 2022-07-03)" ></div>
</body></html>